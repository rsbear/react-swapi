{"version":3,"file":"static/webpack/static/development/pages/index.js.87f3070a0d315afd4a87.hot-update.js","sources":["webpack:///./hooks/useTypeFilter.ts"],"sourcesContent":["import React, { useState, useEffect, useReducer } from \"react\";\nimport {\n  useAllFilmsLazyQuery,\n  useAllStarshipsLazyQuery,\n  useAllStarshipsQuery,\n  useAllFilmsQuery,\n  useAllPersonsQuery\n} from \"../generated/graphql\";\n\nconst initState = {\n  isLoading: true,\n  browseType: \"films\",\n  mainList: [],\n  characterList: [],\n  filterByCharacter: \"\"\n};\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case \"setLoading\":\n      return { ...state, isLoading: true };\n    case \"setBrowse\":\n      return { ...state, browseType: action.payload };\n    case \"setMainList\":\n      return { ...state, mainList: action.payload, isLoading: false };\n    case \"characterList\":\n      return { ...state, characterList: action.payload };\n    case \"setFilterByCharacter\":\n      return { ...state, filterByCharacter: action.payload };\n    default:\n      return [];\n  }\n};\n\nexport const useTypeFilter = () => {\n  const [state, dispatch] = useReducer(reducer, initState);\n  const films = useAllFilmsQuery();\n  const persons = useAllPersonsQuery();\n  const starships = useAllStarshipsQuery();\n\n  useEffect(() => {\n    if (persons.loading) {\n      return;\n    } else if (!persons.error && persons.data) {\n      let personsArr = persons.data.allPersons.map(p => p.name)\n      dispatch({ type: \"characterList\", payload: personsArr })\n    }\n  }, [persons]);\n\n  useEffect(() => {\n    if (state.browseType === \"films\") {\n      if (films.loading) {\n        dispatch({ type: \"setLoading\" });\n      } else if (!films.error && films.data) {\n        dispatch({ type: \"setMainList\", payload: films.data.allFilms });\n      }\n    }\n  }, [films, state.browseType]);\n\n  useEffect(() => {\n    if (state.browseType === \"persons\") {\n      if (persons.loading) {\n        dispatch({ type: \"setLoading\" });\n      } else if (!persons.error && persons.data) {\n        dispatch({ type: \"setMainList\", payload: persons.data.allPersons });\n      }\n    }\n  }, [persons, state.browseType]);\n\n  useEffect(() => {\n    if (state.browseType === \"starships\") {\n      if (starships.loading) {\n        dispatch({ type: \"setLoading\" });\n      } else if (!starships.error && starships.data) {\n        dispatch({ type: \"setMainList\", payload: starships.data.allStarships });\n      }\n    }\n  }, [starships, state.browseType]);\n\n\n  useEffect(() => {\n    // get filterByCharacter\n    // map over movies in order to map over the characters in each film\n    // if films.characters includes filterByCharacter remove everything else\n\n    if (state.browseType === \"films\") {\n      for (let f of state.mainList) {\n        const nameMap = f.characters.map((c) => c.name)\n        if (nameMap.includes(state.filterByCharacter)) {\n          console.log(`character is in this movies`)\n          const newList = state.mainList.filter(x => x.id !== f.id)\n          dispatch({ type: 'setMainList', payload: newList })\n        }\n      }\n    }\n  }, [state.filterByCharacter])\n\n  return [state, dispatch];\n};\n\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AALA;AACA;AAOA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAZA;AAcA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAPA;AACA;AAAA;AAAA;AAOA;AARA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AAEA;AACA;;;;A","sourceRoot":""}